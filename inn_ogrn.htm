<!DOCTYPE html>
<html>
<head>
	<title>Калькулятор ИНН и ОГРН</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<style>
		input[type='text'] {width: 120px}
		input[type='button']
		{
			width: 80px;
			outline:none;
			transition: all 0.25s ease-in-out;
			-webkit-transition: all 0.25s ease-in-out;
			-moz-transition: all 0.25s ease-in-out;
		}
		input.glowGreen
		{
			box-shadow: 0 0 5px rgba(0, 255, 0, 1);
			-webkit-box-shadow: 0 0 5px rgba(0, 255, 0, 1);
			-moz-box-shadow: 0 0 5px rgba(0, 255, 0, 1);
		}
		input.glowRed
		{
			box-shadow: 0 0 5px rgba(255, 0, 0, 1);
			-webkit-box-shadow: 0 0 5px rgba(255, 0, 0, 1);
			-moz-box-shadow: 0 0 5px rgba(255, 0, 0, 1);
		}
		label
		{
		    display: block;
		    float: left;
		    width: 80px;
		}
		label.checkbox
		{
			width: auto;
		}
	</style>
	<script type="text/javascript">
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-3928499-7', 'mobobe.com');
		ga('send', 'pageview');
	</script>
</head>
<body>
	<div id="calc">
		<div>
			<label for="innul">ИНН ЮЛ</label>
			<input id="innul" type="text" maxlength="10" placeholder="10 цифр" oninput="CheckInnUlButtons()">
			<input id="innulbutton" type="button" onclick="RandomInnUl()" value="Random">
		</div>
		<div>
			<label for="innfl">ИНН ИП</label>
			<input id="innfl" type="text" maxlength="12" placeholder="12 цифр" oninput="CheckInnFlButtons()">
			<input id="innflbutton" type="button" onclick="RandomInnFl()" value="Random">
		</div>
		<div>
			<label for="ogrnul">ОГРН ЮЛ</label>
			<input id="ogrnul" type="text" maxlength="13" placeholder="13 цифр" oninput="CheckOgrnUlButtons()">
			<input id="ogrnulbutton" type="button" onclick="RandomOgrnUl()" value="Random">
		</div>
		<div>
			<label for="ogrnfl">ОГРН ИП</label>
			<input id="ogrnfl" type="text" maxlength="15" placeholder="15 цифр" oninput="CheckOgrnFlButtons()">
			<input id="ogrnflbutton" type="button" onclick="RandomOgrnFl()" value="Random">
		</div>
		<div>
			<label for="okpo">ОКПО</label>
			<input id="okpo" type="text" maxlength="14" placeholder="от 8 до 14 цифр" oninput="CheckOkpoButtons()">
			<input id="okpobutton" type="button" onclick="RandomOkpo()" value="Random">
		</div>
		<div>
			<label for="snils">СНИЛС</label>
			<input id="snils" type="text" maxlength="14" placeholder="11 цифр" oninput="CheckSnilsButtons()">
			<input id="snilsbutton" type="button" onclick="RandomSnils()" value="Random">
		</div>
		<div>
			<input id="format_snils" type="checkbox" onchange="ReformatSnils()">
			<label for="format_snils" class="checkbox">Форматировать СНИЛС</label>
		</div>
	</div>
	<script type="text/javascript">
		function GetRandomNumber(str, length, force, validFirstDigits)
		{
			var result = GetNumbersFromString("" + str);
			if (result.length > length || force)
				result = "";

			if (validFirstDigits && validFirstDigits.length)
				result += validFirstDigits[Math.floor(Math.random()*validFirstDigits.length)];
			for (var i = result.length; i < length; i++)
				result += Math.floor(Math.random() * 10);
			return result;
		}
		function CalcInnUl(inn)
		{
			if (inn == null) return "";
			if (inn.length < 9) return inn;
			inn = inn.substr(0, 9);
			var i1 = parseInt(inn[0], 10);
			var i2 = parseInt(inn[1], 10);
			var i3 = parseInt(inn[2], 10);
			var i4 = parseInt(inn[3], 10);
			var i5 = parseInt(inn[4], 10);
			var i6 = parseInt(inn[5], 10);
			var i7 = parseInt(inn[6], 10);
			var i8 = parseInt(inn[7], 10);
			var i9 = parseInt(inn[8], 10);
			var c = (i1 * 2 + i2 * 4 + i3 * 10 + i4 * 3 + i5 * 5 + i6 * 9 + i7 * 4 + i8 * 6 + i9 * 8) % 11 % 10;
			return inn + c;
		}
		function CalcInnFl(inn)
		{
			if (inn == null) return "";
			if (inn.length < 10) return inn;
			inn = inn.substr(0, 10);
			var i1 = parseInt(inn[0], 10);
			var i2 = parseInt(inn[1], 10);
			var i3 = parseInt(inn[2], 10);
			var i4 = parseInt(inn[3], 10);
			var i5 = parseInt(inn[4], 10);
			var i6 = parseInt(inn[5], 10);
			var i7 = parseInt(inn[6], 10);
			var i8 = parseInt(inn[7], 10);
			var i9 = parseInt(inn[8], 10);
			var i0 = parseInt(inn[9], 10);
			var c1 = (i1 * 7 + i2 * 2 + i3 * 4 + i4 * 10 + i5 * 3 + i6 * 5 + i7 * 9 + i8 * 4 + i9 * 6 + i0 * 8) % 11 % 10;
			var c2 = (i1 * 3 + i2 * 7 + i3 * 2 + i4 * 4 + i5 * 10 + i6 * 3 + i7 * 5 + i8 * 9 + i9 * 4 + i0 * 6 + c1 * 8) % 11 % 10;
			return inn + c1 + c2;
		}
		function CalcOgrnUl(ogrn)
		{
			if (ogrn == null) return "";
			if (ogrn.length < 12) return ogrn;
			ogrn = ogrn.substr(0, 12);
			var op = parseInt(ogrn, 10);
			var c = (op % 11) % 10;
			return ogrn + c;
		}
		function CalcOgrnFl(ogrn)
		{
			if (ogrn == null) return "";
			if (ogrn.length < 14) return ogrn;
			ogrn = ogrn.substr(0, 14);
			var op = parseInt(ogrn, 10);
			var c = op % 13 % 10;
			return ogrn + c;
		}
		function CalcOkpo(okpo)
		{
			if (okpo == null) return "";
			if (okpo.length < 8) return okpo;
			var c = 0;
			for (var i = 1; i < okpo.length; i++)
				c += parseInt(okpo[i - 1], 10) * ((i - 1) % 10 + 1);
			if (c % 11 == 10)
			{
				c = 0;
				for (var i = 1; i < okpo.length; i++)
					c += parseInt(okpo[i - 1], 10) * ((i + 1) % 10 + 1);
			}
			c = (c % 11) % 10;
			return okpo.substr(0, okpo.length - 1) + c;
		}
		function GetNumbersFromString(stringNumber)
		{
			if (stringNumber == null || stringNumber == "") return stringNumber;
			var result = "";
			for (var i=0; i<stringNumber.length; i++)
				if (stringNumber[i] >= "0" && stringNumber[i] <= "9")
					result += stringNumber[i];
			return result;
		}
		function FormatSnils(snilsNumber)
		{
			snilsNumber = GetNumbersFromString(snilsNumber);
			if (snilsNumber.length < 11)
				return snilsNumber;
			if (!document.getElementById('format_snils').checked)
				return snilsNumber;
			return snilsNumber.substr(0, 3) + "-" + snilsNumber.substr(3, 3) + "-" + snilsNumber.substr(6, 3) + " " + snilsNumber.substr(9, 2);
		}
		function ReformatSnils()
		{
			snils.value = FormatSnils(snils.value);
		}
		function CalcSnils(snils)
		{
			if (snils == null) return "";
			var originalSnils = snils;
			snils = GetNumbersFromString(snils);
			if (snils.length < 9) return originalSnils;
			originalSnils = snils;
			snils = snils.substr(0, 9);
			if (parseInt(snils, 10) < 1001999)
				return FormatSnils(originalSnils + "00");

			var c = 0;
			for (var i = 9; i > 0; i--)
				c += parseInt(snils[9 - i] * i);
			if (c > 101)
				c = c % 101;
			if (c == 100 || c == 101)
				c = 0;
			return FormatSnils(snils + (c < 10 ? "0" + c : c));
		}

		var innul = document.getElementById('innul');
		var innfl = document.getElementById('innfl');
		var ogrnul = document.getElementById('ogrnul');
		var ogrnfl = document.getElementById('ogrnfl');
		var okpo = document.getElementById('okpo');
		var snils = document.getElementById('snils');
		var innulButton = document.getElementById('innulbutton');
		var innflButton = document.getElementById('innflbutton');
		var ogrnulButton = document.getElementById('ogrnulbutton');
		var ogrnflButton = document.getElementById('ogrnflbutton');
		var okpoButton = document.getElementById('okpobutton');
		var snilsButton = document.getElementById('snilsbutton');

		function FixInnUl()
		{
			innul.value = CalcInnUl(innul.value);
			innul.oninput();
		}
		function RandomInnUl()
		{
			innul.value = CalcInnUl(GetRandomNumber(innul.value, 9));
			innul.oninput();
		}
		function FixInnFl()
		{
			innfl.value = CalcInnFl(innfl.value);
			innfl.oninput();
		}
		function RandomInnFl()
		{
			innfl.value = CalcInnFl(GetRandomNumber(innfl.value, 10));
			innfl.oninput();
		}
		function FixOgrnUl()
		{
			ogrnul.value = CalcOgrnUl(ogrnul.value);
			ogrnul.oninput();
		}
		function RandomOgrnUl()
		{
			ogrnul.value = CalcOgrnUl(GetRandomNumber(ogrnul.value, 12, false, [1, 2, 5]));
			ogrnul.oninput();
		}
		function FixOgrnFl()
		{
			ogrnfl.value = CalcOgrnFl(ogrnfl.value);
			ogrnfl.oninput();
		}
		function RandomOgrnFl()
		{
			ogrnfl.value = CalcOgrnFl(GetRandomNumber(ogrnfl.value, 14, false, [3, 4]));
			ogrnfl.oninput();
		}
		function FixOkpo()
		{
			okpo.value = CalcOkpo(okpo.value);
			okpo.oninput();
		}
		function RandomOkpo()
		{
			okpo.value = CalcOkpo(GetRandomNumber(okpo.value, 13, true));
			okpo.oninput();
		}
		function FixSnils()
		{
			snils.value = CalcSnils(snils.value);
			snils.oninput();
		}
		function RandomSnils()
		{
			snils.value = CalcSnils(GetRandomNumber(snils.value, 10));
			snils.oninput();
		}

		function CheckInnUlButtons()
		{
			CheckButtons(innul, innulButton, RandomInnUl, FixInnUl, CalcInnUl, 9);
		}
		function CheckInnFlButtons()
		{
			CheckButtons(innfl, innflButton, RandomInnFl, FixInnFl, CalcInnFl, 10);
		}
		function CheckOgrnUlButtons()
		{
			CheckButtons(ogrnul, ogrnulButton, RandomOgrnUl, FixOgrnUl, CalcOgrnUl, 12);
		}
		function CheckOgrnFlButtons()
		{
			CheckButtons(ogrnfl, ogrnflButton, RandomOgrnFl, FixOgrnFl, CalcOgrnFl, 14);
		}
		function CheckOkpoButtons()
		{
			CheckButtons(okpo, okpoButton, RandomOkpo, FixOkpo, CalcOkpo, 8);
		}
		function CheckSnilsButtons()
		{
			CheckButtons(snils, snilsButton, RandomSnils, FixSnils, CalcSnils, 9, 11);
		}
		function CheckButtons(input, inputButton, randomFunc, fixFunc, calcFunc, threshold, maxlen)
		{
			var pureNum = GetNumbersFromString(input.value) || "";
			maxlen = maxlen || input.maxLength;
			if (pureNum.length < threshold)
			{
				input.className = '';
				inputButton.value = 'Random';
				inputButton.onclick = randomFunc;
			}
			else
			{
				inputButton.onclick = fixFunc;
				if (pureNum.length == maxlen || input.id == 'okpo')
				{
					if (input.value == calcFunc(input.value))
					{
						input.className = 'glowGreen';
						inputButton.value = 'Random';
						inputButton.onclick = randomFunc;
					}
					else
					{
						input.className = 'glowRed';
						inputButton.value = 'Fix';
					}
				}
				else
				{
					input.className = '';
					inputButton.value = 'Fix';
				}
			}
		}

		var input = document.getElementsByTagName('input');
		for (var i = 0; i < input.length; i++)
			if (input[i].type == 'text' && input[i].oninput)
				input[i].oninput();
	</script>
	</body>
</html>
